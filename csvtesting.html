<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style> /* set the CSS */

    div.tooltip {
        position: absolute;
        text-align: center;
        width: 60px;
        height: 28px;
        padding: 2px;
        font: 12px sans-serif;
        background: lightgray;
        border: 0px;
        border-radius: 2px;
        pointer-events: none;
    }
    .axis text {
        font-family: sans-serif;
        font-size: 8px;
    }
    .arc text {
        font-family: sans-serif;
        font-size: 12px;
    }
    .axis path,
    .axis line {
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }

    .container {
        float: left;
    }

    p {
        text-align:center;
        font-family: sans-serif;
        font-size: 18px;
        border-bottom: 3px double;
    }
    #content {
        position: relative;
    }
    #content img {
        position: absolute;
        top: -15px;
        right: 0px;
    }



    </style>
    <title>Trevor Toll's Project 1: H517 Visualization Design, Analysis,
        & Evaluation</title>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
</head>

<body>

<div id="content">
    <img src="iu_logo.png" class="ribbon" width="25"/>
    <div><p> Trevor Toll's Project 1 for H517 Visualization Design, Analysis,
        & Evaluation</p></div>
</div>



<div class="container" id="area1">
</div>
<div class="container" id="area2">
</div>




<script type="text/javascript">

    var margin = {top: 25, right: 0, bottom: 40, left: 15};


    d3.csv('deaths_age_sex.csv', function(deathsByAge)
    {

        var deathsByAgeData = d3.nest()
            .key(function(d) { return d.age;})
            .rollup(function(d) {
                return d3.sum(d, function(d) {return 1; });
            }).entries(deathsByAge);

        var totalDeaths = d3.nest()
            .key(function(d) { return 1;})
            .rollup(function(d) {
                return d3.sum(d, function(g) {return 1; });
            }).entries(deathsByAge);

        var totalDeathCount = totalDeaths[0].values;

        deathsByAgeData.forEach(function(d,i) {
            if (d.key == 0) {
                d.Age = +d.key;
                d.Deaths = +d.values;
                d.Percent = d.Deaths/totalDeathCount;
                d.CensusPct = .28;
                d.AgeGroup = '0-10'
            }
            if (d.key == 1) {
                d.Age = +d.key;
                d.Deaths = +d.values;
                d.Percent = d.Deaths/totalDeathCount;
                d.CensusPct = .25;
                d.AgeGroup = '11-20'}
            if (d.key == 2) {
                d.Age = +d.key;
                d.Deaths = +d.values;
                d.Percent = d.Deaths/totalDeathCount;
                d.CensusPct = .30;
                d.AgeGroup = '21-40';}
            if (d.key == 3) {
                d.Age = +d.key;
                d.Deaths = +d.values;
                d.Percent = d.Deaths/totalDeathCount;
                d.CensusPct = .13;
                d.AgeGroup = '41-60';}
            if (d.key == 4) {
                d.Age = +d.key;
                d.Deaths = +d.values;
                d.Percent = d.Deaths/totalDeathCount;
                d.CensusPct = .04;
                d.AgeGroup = '61-80';}
            if (d.key == 5) {
                d.Age = +d.key;
                d.Deaths = +d.values;
                d.Percent = d.Deaths/totalDeathCount;
                d.CensusPct = .01;
                d.AgeGroup = '> 80';}
        });

        var CHART_WIDTH = 500;
        var CHART_HEIGHT = 300;
        console.log(deathsByAgeData)

        var svgScatterPlot = d3.select("#area2").append("svg")
            .attr("width", CHART_WIDTH)
            .attr("height", CHART_HEIGHT);


        var xScale = d3.scale.linear();
        var yScale = d3.scale.linear();

        var xScaleMax= d3.max(d3.values(deathsByAgeData), function(d) {return d.CensusPct;});
        var yScaleMax= d3.max(d3.values(deathsByAgeData), function(d) {return d.Percent;});


        xScale.domain([0, xScaleMax + .1]).range([0, CHART_WIDTH-margin.left]);
        yScale.domain([0, yScaleMax + .1]).range([CHART_HEIGHT-margin.top, margin.bottom]);

        svgScatterPlot.selectAll("legends")
            .data(deathsByAgeData)
            .enter()
            .append("circle")
            .attr("cx", function(d,i) {
                return xScale(d.CensusPct)+margin.left+25
                    ;
            })
            .attr("cy", function(d,i) {
                return yScale(d.Percent)-margin.bottom
                    ;
            })
            .attr("r", 7)
            .attr("fill",  "gray");

        svgScatterPlot.selectAll("text")  // <-- Note "text", not "circle" or "rect"
            .data(deathsByAgeData)
            .enter()
            .append("text")     // <-- Same here!
            .attr("x", function(d) {
                return xScale(d.CensusPct)+margin.left+25
                    ;
            })
            .attr("y", function(d) {
                return yScale(d.Percent)-margin.bottom+17
                    ;
            })
            .attr("font-family", "sans-serif")
            .attr("font-size", "12px")
            .attr("fill", "blue")
            .text(function(d) {
                return d.AgeGroup;
            });

        var g = d3.select('svgScatterPlot').select('g');



        var xAxis = d3.svg.axis()
            .scale(xScale)
            .orient("bottom");

        var yAxis = d3.svg.axis()
            .scale(yScale)
            .orient("left")
            .ticks(10);


        svgScatterPlot.append("g")
            .attr("class", "axis")
            .attr("transform", "translate(" + (margin.left+25) +"," +(CHART_HEIGHT-margin.bottom) + ")")
            .call(xAxis)
            .selectAll("text")
            .attr("x", 9)
            .attr("dy", ".35em")
            .attr("transform", "rotate(45)")
            .style("text-anchor", "start");

        svgScatterPlot.append('g')
            .attr('class', 'axis')
            .attr("transform", "translate(" + (margin.left+25) +", -15  )")
            .call(yAxis)
            .append("text")
            .attr("class", "label")
            .attr("transform", "rotate(-90)")
            .attr("y", -30)
            .attr("x", -100)
            .style("text-anchor", "end")
            .style("font-size", "10px")
            .text("% of Total Cholera Deaths");

        svgScatterPlot.append('text')
            .attr("class","text")
            .attr("x", 250)
            .attr("y", 297)
            .attr("text-anchor", "middle")
            .style("font-size", "10px")
            .text("Census % of Total Population");


        svgScatterPlot.append('text')
            .attr("class","text")
            .attr("x", 250)
            .attr("y", 15)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .text("Deaths vs Census - Percent of Population by Age Group");

    });





</script>

</body>
</html>